@model NetC.JuniorDeveloperExam.Web.Models.Blog
@using NetC.JuniorDeveloperExam.Web.ViewModels
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = Model.Title;

}

<div class="container">
    <div class="row">

        <!-- Blog post content -->
        <div class="col-lg-12">

            <!-- Title -->
            <h1 class="mt-4">@Model.Title</h1>

            <hr>

            <!-- Date/Time -->
            <p>Posted on @Model.Date.ToString("MMMM dd, yyyy")</p>

            <hr>

            <!-- Preview Image -->
            <img class="img-fluid rounded" src="@Model.Image" alt="@Model.Title">

            <hr>

            <!-- Post Content -->
            @Html.Raw(Model.HtmlContent)

            <hr>

            @if (Model.Comments != null)
            {
                foreach (var comment in Model.Comments)
                {
                    var nameParts = comment.Name.Split(' ');
                    var queryString = String.Join("+", nameParts);

                    <div class="comment-block">
                        <div class="media mb-4 comment">
                            <img class="d-flex mr-3 rounded-circle user-avatar" src="https://eu.ui-avatars.com/api/?name=@queryString" alt="@comment.Name">
                            <div class="media-body">
                                <h5 class="mt-0">@comment.Name <small><em>(@comment.Date.ToString("MMMM dd, yyyy - HH:mm"))</em></small></h5>
                                @comment.Message
                            </div>


                        </div>
                        @Html.Partial("~/Views/Partials/_ReplyBlock.cshtml", comment)

                        @Html.Partial("~/Views/Partials/_ReplyForm.cshtml", new CommentReplyFormViewModel() { BlogId = Model.Id, CommentId = comment.Id })
                    </div>
                }
            }

            @Html.Partial("~/Views/Partials/_CommentForm.cshtml", new CommentFormViewModel() { BlogId = Model.Id })

        </div>
    </div>
</div>

<script>
    function ToggleReplyForm(commentId) {
        const showButton = document.querySelector(`.js-show-form[data-comment-id='${commentId}']`);
        const form = document.querySelector(`.js-reply-form[data-comment-id='${commentId}']`);

        if (form.style.display == "none") {
            showButton.style.display = "none";
            form.style.display = "block";
        }
        else {
            showButton.style.display = "inline-block";
            form.style.display = "none";
        }
    }


    function ToggleReplyBlock(commentId) {
        const replyBlock = document.querySelector(`.js-reply-block[data-comment-id='${commentId}']`);
        const showReplies = document.querySelector(`.js-show-replies[data-comment-id='${commentId}']`);
        const hideReplies = document.querySelector(`.js-hide-replies[data-comment-id='${commentId}']`);


        if (replyBlock.style.display == "none") {
            replyBlock.style.display = "block"
            showReplies.style.display = "none"
            hideReplies.style.display = "inline-block"
        }
        else {
            replyBlock.style.display = "none"
            showReplies.style.display = "inline-block"
            hideReplies.style.display = "none"
        }
    }
</script>
